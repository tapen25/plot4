<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èº«ä½“ã¨éŸ³æ¥½ã®å”å¥ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <style>
        /* ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®è¦‹ãŸç›®ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º */
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen font-sans">
    <div id="startScreen" class="absolute inset-0 bg-gray-900 bg-opacity-90 flex items-center justify-center z-20">
        <button id="startButton" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-8 rounded-full text-xl shadow-lg transform hover:scale-105 transition-transform">
            ä½“é¨“ã‚’é–‹å§‹ã™ã‚‹
        </button>
    </div>

    <div class="w-full max-w-md mx-auto bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-8 space-y-6">
        
        <div class="text-center">
            <h1 class="text-2xl font-bold text-white">èº«ä½“ã¨éŸ³æ¥½ã®å”å¥</h1>
            <p class="text-gray-400 mt-1">ã‚ãªãŸã®èº«ä½“ãŒã€éŸ³æ¥½ã‚’å¥ã§ã‚‹</p>
        </div>

        <!--  -->
        
        <!-- çŠ¶æ…‹è¡¨ç¤ºãƒ‘ãƒãƒ« -->
        <div class="bg-gray-700 rounded-xl p-4 grid grid-cols-2 gap-4 text-center">
            <div>
                <p class="text-sm text-gray-400">æŒ‡æ®: æ­©è¡Œãƒšãƒ¼ã‚¹ (SPM)</p>
                <p id="spmDisplay" class="text-3xl font-bold text-cyan-400">80</p>
                <p class="text-sm text-gray-400 mt-2">â™ª éŸ³æ¥½ãƒ†ãƒ³ãƒ (BPM)</p>
                <p id="bpmDisplay" class="text-lg font-semibold text-cyan-300">80</p>
            </div>
            <div>
                <p class="text-sm text-gray-400">æ„Ÿæƒ…: å¿ƒæ‹æ•° (HR)</p>
                <p id="hrDisplay" class="text-3xl font-bold text-rose-400">70</p>
                <p class="text-sm text-gray-400 mt-2">â™ª éŸ³è‰²</p>
                <p id="timbreDisplay" class="text-lg font-semibold text-rose-300">ç©ã‚„ã‹</p>
            </div>
        </div>

        <!-- æ“ä½œãƒ‘ãƒãƒ« -->
        <div class="pt-4 space-y-6">
            <div>
                <label for="spmSlider" class="text-lg font-semibold flex items-center justify-between">
                    <span>ğŸš¶â€â™‚ï¸ æ­©è¡Œãƒšãƒ¼ã‚¹</span>
                    <span class="text-sm text-gray-400">(ã‚†ã£ãã‚Š â†” ã¯ã‚„ã)</span>
                </label>
                <input id="spmSlider" type="range" min="40" max="180" value="80" class="w-full h-3 bg-gray-600 rounded-lg appearance-none cursor-pointer mt-2 accent-cyan-400">
            </div>
            <div>
                <label for="hrSlider" class="text-lg font-semibold flex items-center justify-between">
                    <span>â¤ï¸ å¿ƒæ‹æ•°</span>
                     <span class="text-sm text-gray-400">(ãƒªãƒ©ãƒƒã‚¯ã‚¹ â†” èˆˆå¥®)</span>
                </label>
                <input id="hrSlider" type="range" min="60" max="160" value="70" class="w-full h-3 bg-gray-600 rounded-lg appearance-none cursor-pointer mt-2 accent-rose-400">
            </div>
        </div>
        
    </div>

    <script>
        // --- DOMè¦ç´  ---
        const startScreen = document.getElementById('startScreen');
        const startButton = document.getElementById('startButton');
        const spmDisplay = document.getElementById('spmDisplay');
        const bpmDisplay = document.getElementById('bpmDisplay');
        const hrDisplay = document.getElementById('hrDisplay');
        const timbreDisplay = document.getElementById('timbreDisplay');
        const spmSlider = document.getElementById('spmSlider');
        const hrSlider = document.getElementById('hrSlider');

        // --- éŸ³æ¥½ã‚¨ãƒ³ã‚¸ãƒ³ (Tone.js) ---
        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼: éŸ³ã®ã€Œé‹­ã•ã€ã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
        const filter = new Tone.AutoFilter('4n').toDestination().start();
        filter.depth.value = 0.8;
        // ã‚·ãƒ³ã‚»ã‚µã‚¤ã‚¶ãƒ¼: éŸ³ã®ã€Œå…ƒã€ã¨ãªã‚‹éƒ¨åˆ†
        const synth = new Tone.PolySynth(Tone.Synth, {
            oscillator: { type: 'triangle' }, // ä¸‰è§’æ³¢ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆ
            envelope: { attack: 0.02, decay: 0.1, sustain: 0.3, release: 1 }
        }).connect(filter);
        synth.volume.value = -8;

        // ç°¡å˜ãªã‚¢ãƒ«ãƒšã‚¸ã‚ªï¼ˆåˆ†æ•£å’ŒéŸ³ï¼‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®šç¾©
        const pattern = new Tone.Pattern((time, note) => {
            synth.triggerAttackRelease(note, '8n', time);
        }, ['C3', 'E3', 'G3', 'B3', 'C4', 'B3', 'G3', 'E3'], 'up');
        pattern.interval = '8n';

        // --- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®çŠ¶æ…‹ ---
        let currentSpm = 80;
        let currentHr = 70;

        // --- ãƒ¡ã‚¤ãƒ³æ›´æ–°é–¢æ•° ---
        function updateMusicAndUI() {
            // 1. UIã‚’æ›´æ–°
            spmDisplay.textContent = currentSpm;
            hrDisplay.textContent = currentHr;
            bpmDisplay.textContent = currentSpm; // SPMã‚’BPMã«ç›´æ¥åæ˜ 

            // 2. éŸ³æ¥½ã®ãƒ†ãƒ³ãƒã‚’æ›´æ–° (æ»‘ã‚‰ã‹ã«å¤‰åŒ–ã•ã›ã‚‹)
            Tone.Transport.bpm.rampTo(currentSpm, 0.5);

            // 3. å¿ƒæ‹æ•°ã«å¿œã˜ã¦éŸ³è‰²ã‚’æ›´æ–°
            // å¿ƒæ‹æ•°ãŒä½ã„(60) -> ç©ã‚„ã‹, å¿ƒæ‹æ•°ãŒé«˜ã„(160) -> é‹­ã„
            const hrNormalized = (currentHr - 60) / 100; // 0.0 ~ 1.0 ã®ç¯„å›²ã«æ­£è¦åŒ–

            // a. æ³¢å½¢ã‚’å¤‰åŒ–ã•ã›ã‚‹
            if (currentHr < 90) {
                synth.set({ oscillator: { type: 'sine' } });
                timbreDisplay.textContent = 'ç©ã‚„ã‹';
            } else if (currentHr < 130) {
                synth.set({ oscillator: { type: 'triangle' } });
                timbreDisplay.textContent = 'ã‚¯ãƒªã‚¢';
            } else {
                synth.set({ oscillator: { type: 'sawtooth' } });
                timbreDisplay.textContent = 'é‹­ã„';
            }
            
            // b. ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®å‘¨æ³¢æ•°ã‚’å¤‰åŒ–ã•ã›ã‚‹ (é«˜ã„ã»ã©æ˜ã‚‹ãé‹­ã„éŸ³ã«)
            // 200Hz (ã“ã‚‚ã£ãŸéŸ³) ã‹ã‚‰ 5000Hz (é–‹ã„ãŸéŸ³) ã®ç¯„å›²ã§å¤‰åŒ–
            const filterFreq = 200 + hrNormalized * 4800;
            filter.baseFrequency = filterFreq;
        }

        // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ ---
        spmSlider.addEventListener('input', (event) => {
            currentSpm = parseInt(event.target.value);
            updateMusicAndUI();
        });

        hrSlider.addEventListener('input', (event) => {
            currentHr = parseInt(event.target.value);
            updateMusicAndUI();
        });

        startButton.addEventListener('click', () => {
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã‚’ãã£ã‹ã‘ã«ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚’é–‹å§‹
            Tone.start();
            Tone.Transport.start();
            pattern.start(0);
            
            console.log('éŸ³æ¥½ä½“é¨“ã‚’é–‹å§‹ã—ã¾ã™');
            startScreen.style.display = 'none';
            // åˆæœŸå€¤ã‚’åæ˜ 
            updateMusicAndUI();
        });
    </script>
</body>
</html>
